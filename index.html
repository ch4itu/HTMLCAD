<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="HTMLCAD - Professional CAD application in pure HTML/CSS/JavaScript with AutoCAD-like interface">
    <title>HTMLCAD - Web-Based CAD Application</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="logo">HTML<span>CAD</span></div>
            <div class="menu-bar">
                <div class="menu-item" onclick="Storage.openFileDialog('.json', Storage.importJSON)">Open</div>
                <div class="menu-item" onclick="Storage.saveToLocalStorage()">Save</div>
                <div class="menu-item" onclick="Storage.exportDXF()">Export DXF</div>
                <div class="menu-item" onclick="Storage.exportSVG()">Export SVG</div>
                <div class="menu-item" onclick="Storage.exportJSON()">Export JSON</div>
            </div>
            <div class="spacer"></div>
            <div class="file-name" id="fileName">Untitled.dwg</div>
        </div>

        <!-- Ribbon Toolbar -->
        <div class="ribbon">
            <div class="ribbon-tabs">
                <div class="ribbon-tab active" data-tab="home" onclick="UI.switchRibbonTab('home')">Home</div>
                <div class="ribbon-tab" data-tab="draw" onclick="UI.switchRibbonTab('draw')">Draw</div>
                <div class="ribbon-tab" data-tab="modify" onclick="UI.switchRibbonTab('modify')">Modify</div>
                <div class="ribbon-tab" data-tab="view" onclick="UI.switchRibbonTab('view')">View</div>
            </div>

            <!-- Home Tab Content -->
            <div class="ribbon-content" data-tab="home" style="display: flex;">
                <!-- Draw Panel -->
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="line" onclick="App.executeCommand('line')" title="Line (L)">
                            <i class="icon">/</i>
                            <span class="label">Line</span>
                        </button>
                        <button class="tool-btn" data-cmd="polyline" onclick="App.executeCommand('polyline')" title="Polyline (PL)">
                            <i class="icon">~</i>
                            <span class="label">Polyline</span>
                        </button>
                        <button class="tool-btn" data-cmd="circle" onclick="App.executeCommand('circle')" title="Circle (C)">
                            <i class="icon">&#9675;</i>
                            <span class="label">Circle</span>
                        </button>
                        <button class="tool-btn" data-cmd="arc" onclick="App.executeCommand('arc')" title="Arc (A)">
                            <i class="icon">&#8978;</i>
                            <span class="label">Arc</span>
                        </button>
                        <button class="tool-btn" data-cmd="rect" onclick="App.executeCommand('rect')" title="Rectangle (REC)">
                            <i class="icon">&#9633;</i>
                            <span class="label">Rectangle</span>
                        </button>
                        <button class="tool-btn" data-cmd="ellipse" onclick="App.executeCommand('ellipse')" title="Ellipse (EL)">
                            <i class="icon">&#11053;</i>
                            <span class="label">Ellipse</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Draw</div>
                </div>

                <!-- Modify Panel -->
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="move" onclick="App.executeCommand('move')" title="Move (M)">
                            <i class="icon">&#8680;</i>
                            <span class="label">Move</span>
                        </button>
                        <button class="tool-btn" data-cmd="copy" onclick="App.executeCommand('copy')" title="Copy (CO)">
                            <i class="icon">&#8658;</i>
                            <span class="label">Copy</span>
                        </button>
                        <button class="tool-btn" data-cmd="rotate" onclick="App.executeCommand('rotate')" title="Rotate (RO)">
                            <i class="icon">&#8635;</i>
                            <span class="label">Rotate</span>
                        </button>
                        <button class="tool-btn" data-cmd="mirror" onclick="App.executeCommand('mirror')" title="Mirror (MI)">
                            <i class="icon">&#8696;</i>
                            <span class="label">Mirror</span>
                        </button>
                        <button class="tool-btn" data-cmd="scale" onclick="App.executeCommand('scale')" title="Scale (SC)">
                            <i class="icon">&#8690;</i>
                            <span class="label">Scale</span>
                        </button>
                        <button class="tool-btn" data-cmd="trim" onclick="App.executeCommand('trim')" title="Trim (TR)">
                            <i class="icon">&#9986;</i>
                            <span class="label">Trim</span>
                        </button>
                        <button class="tool-btn" data-cmd="offset" onclick="App.executeCommand('offset')" title="Offset (O)">
                            <i class="icon">&#8741;</i>
                            <span class="label">Offset</span>
                        </button>
                        <button class="tool-btn" data-cmd="erase" onclick="App.executeCommand('erase')" title="Erase (E)">
                            <i class="icon">&#10005;</i>
                            <span class="label">Erase</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Modify</div>
                </div>

                <!-- Layers Panel -->
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <div class="layer-control">
                            <button class="tool-btn small" onclick="UI.addNewLayer()" title="New Layer">
                                <i class="icon">+</i>
                            </button>
                            <select id="layerSelect" class="layer-select" onchange="UI.onLayerChange()"></select>
                            <input type="color" id="layerColor" class="color-picker" value="#ffffff"
                                   onchange="UI.onLayerColorChange()" title="Layer Color">
                        </div>
                    </div>
                    <div class="ribbon-panel-title">Layers</div>
                </div>

                <!-- Utilities Panel -->
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" onclick="Commands.undo()" title="Undo (Ctrl+Z)">
                            <i class="icon">&#8630;</i>
                            <span class="label">Undo</span>
                        </button>
                        <button class="tool-btn" onclick="Commands.redo()" title="Redo (Ctrl+Y)">
                            <i class="icon">&#8631;</i>
                            <span class="label">Redo</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Utilities</div>
                </div>
            </div>

            <!-- Draw Tab Content -->
            <div class="ribbon-content" data-tab="draw" style="display: none;">
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="line" onclick="App.executeCommand('line')" title="Line (L)">
                            <i class="icon">/</i>
                            <span class="label">Line</span>
                        </button>
                        <button class="tool-btn" data-cmd="polyline" onclick="App.executeCommand('polyline')" title="Polyline (PL)">
                            <i class="icon">~</i>
                            <span class="label">Polyline</span>
                        </button>
                        <button class="tool-btn" data-cmd="circle" onclick="App.executeCommand('circle')" title="Circle (C)">
                            <i class="icon">&#9675;</i>
                            <span class="label">Circle</span>
                        </button>
                        <button class="tool-btn" data-cmd="arc" onclick="App.executeCommand('arc')" title="Arc (A)">
                            <i class="icon">&#8978;</i>
                            <span class="label">Arc</span>
                        </button>
                        <button class="tool-btn" data-cmd="rect" onclick="App.executeCommand('rect')" title="Rectangle (REC)">
                            <i class="icon">&#9633;</i>
                            <span class="label">Rectangle</span>
                        </button>
                        <button class="tool-btn" data-cmd="ellipse" onclick="App.executeCommand('ellipse')" title="Ellipse (EL)">
                            <i class="icon">&#11053;</i>
                            <span class="label">Ellipse</span>
                        </button>
                        <button class="tool-btn" data-cmd="text" onclick="App.executeCommand('text')" title="Text (T)">
                            <i class="icon">A</i>
                            <span class="label">Text</span>
                        </button>
                        <button class="tool-btn" data-cmd="hatch" onclick="App.executeCommand('hatch')" title="Hatch (H)">
                            <i class="icon">&#9618;</i>
                            <span class="label">Hatch</span>
                        </button>
                        <button class="tool-btn" data-cmd="polygon" onclick="App.executeCommand('polygon')" title="Polygon (POL)">
                            <i class="icon">&#11039;</i>
                            <span class="label">Polygon</span>
                        </button>
                        <button class="tool-btn" data-cmd="donut" onclick="App.executeCommand('donut')" title="Donut (DO)">
                            <i class="icon">&#9678;</i>
                            <span class="label">Donut</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Draw</div>
                </div>
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="dimlinear" onclick="App.executeCommand('dimlinear')" title="Linear Dimension (DIM)">
                            <i class="icon">&#8596;</i>
                            <span class="label">DimLinear</span>
                        </button>
                        <button class="tool-btn" data-cmd="dimradius" onclick="App.executeCommand('dimradius')" title="Radius Dimension">
                            <i class="icon">R</i>
                            <span class="label">DimRadius</span>
                        </button>
                        <button class="tool-btn" data-cmd="dimdiameter" onclick="App.executeCommand('dimdiameter')" title="Diameter Dimension">
                            <i class="icon">&#8960;</i>
                            <span class="label">DimDia</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Dimension</div>
                </div>
            </div>

            <!-- Modify Tab Content -->
            <div class="ribbon-content" data-tab="modify" style="display: none;">
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="move" onclick="App.executeCommand('move')" title="Move (M)">
                            <i class="icon">&#8680;</i>
                            <span class="label">Move</span>
                        </button>
                        <button class="tool-btn" data-cmd="copy" onclick="App.executeCommand('copy')" title="Copy (CO)">
                            <i class="icon">&#8658;</i>
                            <span class="label">Copy</span>
                        </button>
                        <button class="tool-btn" data-cmd="rotate" onclick="App.executeCommand('rotate')" title="Rotate (RO)">
                            <i class="icon">&#8635;</i>
                            <span class="label">Rotate</span>
                        </button>
                        <button class="tool-btn" data-cmd="mirror" onclick="App.executeCommand('mirror')" title="Mirror (MI)">
                            <i class="icon">&#8696;</i>
                            <span class="label">Mirror</span>
                        </button>
                        <button class="tool-btn" data-cmd="scale" onclick="App.executeCommand('scale')" title="Scale (SC)">
                            <i class="icon">&#8690;</i>
                            <span class="label">Scale</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Move/Copy</div>
                </div>
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="trim" onclick="App.executeCommand('trim')" title="Trim (TR)">
                            <i class="icon">&#9986;</i>
                            <span class="label">Trim</span>
                        </button>
                        <button class="tool-btn" data-cmd="offset" onclick="App.executeCommand('offset')" title="Offset (O)">
                            <i class="icon">&#8741;</i>
                            <span class="label">Offset</span>
                        </button>
                        <button class="tool-btn" data-cmd="explode" onclick="App.executeCommand('explode')" title="Explode (X)">
                            <i class="icon">&#10043;</i>
                            <span class="label">Explode</span>
                        </button>
                        <button class="tool-btn" data-cmd="erase" onclick="App.executeCommand('erase')" title="Erase (E)">
                            <i class="icon">&#10005;</i>
                            <span class="label">Erase</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Edit</div>
                </div>
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="array" onclick="App.executeCommand('array')" title="Rectangular Array (AR)">
                            <i class="icon">&#9638;</i>
                            <span class="label">Array</span>
                        </button>
                        <button class="tool-btn" data-cmd="fillet" onclick="App.executeCommand('fillet')" title="Fillet (F)">
                            <i class="icon">&#8735;</i>
                            <span class="label">Fillet</span>
                        </button>
                        <button class="tool-btn" data-cmd="chamfer" onclick="App.executeCommand('chamfer')" title="Chamfer (CHA)">
                            <i class="icon">&#9699;</i>
                            <span class="label">Chamfer</span>
                        </button>
                        <button class="tool-btn" data-cmd="break" onclick="App.executeCommand('break')" title="Break (BR)">
                            <i class="icon">&#8689;</i>
                            <span class="label">Break</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Advanced</div>
                </div>
            </div>

            <!-- View Tab Content -->
            <div class="ribbon-content" data-tab="view" style="display: none;">
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" onclick="Commands.zoomExtents()" title="Zoom Extents">
                            <i class="icon">&#8703;</i>
                            <span class="label">Extents</span>
                        </button>
                        <button class="tool-btn" onclick="CAD.zoomIn(); Renderer.draw();" title="Zoom In">
                            <i class="icon">+</i>
                            <span class="label">Zoom In</span>
                        </button>
                        <button class="tool-btn" onclick="CAD.zoomOut(); Renderer.draw();" title="Zoom Out">
                            <i class="icon">-</i>
                            <span class="label">Zoom Out</span>
                        </button>
                        <button class="tool-btn" onclick="App.centerView()" title="Center View">
                            <i class="icon">&#9678;</i>
                            <span class="label">Center</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Zoom</div>
                </div>
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" onclick="UI.toggleGrid()" title="Toggle Grid (F2)">
                            <i class="icon">#</i>
                            <span class="label">Grid</span>
                        </button>
                        <button class="tool-btn" onclick="UI.toggleSnap()" title="Toggle Snap (F3)">
                            <i class="icon">&#8982;</i>
                            <span class="label">Snap</span>
                        </button>
                        <button class="tool-btn" onclick="UI.toggleOrtho()" title="Toggle Ortho (F8)">
                            <i class="icon">&#9482;</i>
                            <span class="label">Ortho</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Display</div>
                </div>
                <div class="ribbon-panel">
                    <div class="ribbon-panel-content">
                        <button class="tool-btn" data-cmd="distance" onclick="App.executeCommand('distance')" title="Measure Distance (DI)">
                            <i class="icon">&#8614;</i>
                            <span class="label">Distance</span>
                        </button>
                        <button class="tool-btn" data-cmd="area" onclick="App.executeCommand('area')" title="Measure Area (AA)">
                            <i class="icon">&#9633;</i>
                            <span class="label">Area</span>
                        </button>
                        <button class="tool-btn" data-cmd="list" onclick="App.executeCommand('list')" title="List Properties (LI)">
                            <i class="icon">&#9776;</i>
                            <span class="label">List</span>
                        </button>
                    </div>
                    <div class="ribbon-panel-title">Inquiry</div>
                </div>
            </div>
        </div>

        <!-- Main Workspace -->
        <div class="workspace">
            <!-- Properties Panel (Left) -->
            <div class="panel-left">
                <div class="panel-header">
                    Properties
                </div>
                <div class="panel-content" id="propertiesPanel">
                    <div class="property-group">
                        <p style="color: var(--text-muted);">No selection</p>
                    </div>
                </div>
            </div>

            <!-- Viewport Container -->
            <div class="viewport-container">
                <!-- Viewport Tabs -->
                <div class="viewport-tabs">
                    <div class="viewport-tab active">
                        Model
                    </div>
                </div>

                <!-- Canvas Viewport -->
                <div class="viewport" id="viewport">
                    <canvas id="canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Command Line Panel -->
        <div class="command-panel">
            <div class="command-history" id="cmdHistory">
                <div class="line">Welcome to HTMLCAD - A Web-Based CAD Application</div>
                <div class="line">Type commands or use toolbar buttons. Press F1 for help.</div>
            </div>
            <div class="command-input-row">
                <span class="command-prompt">Command:</span>
                <input type="text" id="cmdInput" class="command-input"
                       placeholder="Type command here..." autocomplete="off" autofocus>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <span class="status-mode">Model</span>
            </div>
            <div class="status-center">
                <button class="status-btn active" id="statusSnap" onclick="UI.toggleSnap()" title="Object Snap (F3)">SNAP</button>
                <button class="status-btn active" id="statusGrid" onclick="UI.toggleGrid()" title="Grid Display (F2)">GRID</button>
                <button class="status-btn" id="statusOrtho" onclick="UI.toggleOrtho()" title="Ortho Mode (F8)">ORTHO</button>
                <button class="status-btn" id="statusPolar" onclick="UI.togglePolar()" title="Polar Tracking (F10)">POLAR</button>
            </div>
            <div class="status-right">
                <span class="status-coords" id="coordDisplay">0.0000, 0.0000, 0.0000</span>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="Commands.execute('copy'); UI.hideContextMenu();">
            Copy <span class="shortcut">Ctrl+C</span>
        </div>
        <div class="context-menu-item" onclick="CAD.paste(); Renderer.draw(); UI.hideContextMenu();">
            Paste <span class="shortcut">Ctrl+V</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-requires-selection onclick="Commands.execute('erase'); UI.hideContextMenu();">
            Erase <span class="shortcut">Delete</span>
        </div>
        <div class="context-menu-item" data-requires-selection onclick="Commands.execute('move'); UI.hideContextMenu();">
            Move <span class="shortcut">M</span>
        </div>
        <div class="context-menu-item" data-requires-selection onclick="Commands.execute('copy'); UI.hideContextMenu();">
            Copy Objects <span class="shortcut">CO</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="Commands.zoomExtents(); UI.hideContextMenu();">
            Zoom Extents
        </div>
        <div class="context-menu-item" onclick="Commands.undo(); UI.hideContextMenu();">
            Undo <span class="shortcut">Ctrl+Z</span>
        </div>
        <div class="context-menu-item" onclick="Commands.redo(); UI.hideContextMenu();">
            Redo <span class="shortcut">Ctrl+Y</span>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Title</span>
                <button class="modal-close" onclick="UI.hideModal()">&times;</button>
            </div>
            <div class="modal-body">
                Content
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="UI.hideModal()">Cancel</button>
                <button class="btn btn-primary" onclick="UI.hideModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript Modules -->
    <script src="js/utils.js"></script>
    <script src="js/state.js"></script>
    <script src="js/geometry.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/commands.js"></script>
    <script src="js/autolisp.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
